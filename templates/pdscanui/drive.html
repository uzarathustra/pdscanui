{% extends 'pdscanui/base.html' %}

{% block content %}

    <h1 class="text-center">Motor-Control</h1>

    <div class="container">

        <br><br><br><br>

        <div class="row align-items-center">

            <div class="col">

                <div class="row">
                    <!-- XY jogging control panel -->
                    <div id="control-jog-xy" class="col">
                        <br>
                        <h3 class="text-center">X/Y</h3>
                        <br>
                        <table class="center">
                            <tr>
                                <td></td>
                                <td>
                                    <button type="button" id="yinc" class="btn btn-outline-secondary">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                             fill="currentColor" class="bi bi-arrow-up" viewBox="0 0 16 16">
                                            <path fill-rule="evenodd"
                                                  d="M8 15a.5.5 0 0 0 .5-.5V2.707l3.146 3.147a.5.5 0 0 0 .708-.708l-4-4a.5.5 0 0 0-.708 0l-4 4a.5.5 0 1 0 .708.708L7.5 2.707V14.5a.5.5 0 0 0 .5.5z"/>
                                        </svg>
                                    </button>
                                </td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>
                                    <button type="button" id="xdec" class="btn btn-outline-secondary">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                             fill="currentColor" class="bi bi-arrow-left" viewBox="0 0 16 16">
                                            <path fill-rule="evenodd"
                                                  d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8z"/>
                                        </svg>
                                    </button>
                                </td>
                                <td>
                                    <button type="button" id="xyhome" class="btn btn-outline-secondary">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                             fill="currentColor" class="bi bi-house-door" viewBox="0 0 16 16">
                                            <path d="M8.354 1.146a.5.5 0 0 0-.708 0l-6 6A.5.5 0 0 0 1.5 7.5v7a.5.5 0 0 0 .5.5h4.5a.5.5 0 0 0 .5-.5v-4h2v4a.5.5 0 0 0 .5.5H14a.5.5 0 0 0 .5-.5v-7a.5.5 0 0 0-.146-.354L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293L8.354 1.146zM2.5 14V7.707l5.5-5.5 5.5 5.5V14H10v-4a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5v4H2.5z"/>
                                        </svg>
                                    </button>
                                </td>
                                <td>
                                    <button type="button" id="xinc" class="btn btn-outline-secondary">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                             fill="currentColor" class="bi bi-arrow-right" viewBox="0 0 16 16">
                                            <path fill-rule="evenodd"
                                                  d="M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8z"/>
                                        </svg>
                                    </button>
                                </td>
                            </tr>
                            <tr>
                                <td></td>
                                <td>
                                    <button type="button" id="ydec" class="btn btn-outline-secondary">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                             fill="currentColor" class="bi bi-arrow-down" viewBox="0 0 16 16">
                                            <path fill-rule="evenodd"
                                                  d="M8 1a.5.5 0 0 1 .5.5v11.793l3.146-3.147a.5.5 0 0 1 .708.708l-4 4a.5.5 0 0 1-.708 0l-4-4a.5.5 0 0 1 .708-.708L7.5 13.293V1.5A.5.5 0 0 1 8 1z"/>
                                        </svg>
                                    </button>
                                </td>
                                <td></td>
                            </tr>
                        </table>
                    </div>

                    <!-- Z jogging control panel -->
                    <div id="control-jog-z" class="col">
                        <br>
                        <h4 class="text-center">Z</h4>
                        <br>
                        <table class="center">
                            <tr>
                                <td></td>
                                <td>
                                    <button type="button" id="zinc" class="btn btn-outline-secondary">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                             fill="currentColor" class="bi bi-arrow-up" viewBox="0 0 16 16">
                                            <path fill-rule="evenodd"
                                                  d="M8 15a.5.5 0 0 0 .5-.5V2.707l3.146 3.147a.5.5 0 0 0 .708-.708l-4-4a.5.5 0 0 0-.708 0l-4 4a.5.5 0 1 0 .708.708L7.5 2.707V14.5a.5.5 0 0 0 .5.5z"/>
                                        </svg>
                                    </button>
                                </td>
                                <td></td>
                            </tr>
                            <tr>
                                <td></td>
                                <td>
                                    <button type="button" id="zhome" class="btn btn-outline-secondary">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                             fill="currentColor" class="bi bi-house-door" viewBox="0 0 16 16">
                                            <path d="M8.354 1.146a.5.5 0 0 0-.708 0l-6 6A.5.5 0 0 0 1.5 7.5v7a.5.5 0 0 0 .5.5h4.5a.5.5 0 0 0 .5-.5v-4h2v4a.5.5 0 0 0 .5.5H14a.5.5 0 0 0 .5-.5v-7a.5.5 0 0 0-.146-.354L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293L8.354 1.146zM2.5 14V7.707l5.5-5.5 5.5 5.5V14H10v-4a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5v4H2.5z"/>
                                        </svg>
                                    </button>
                                </td>
                                <td></td>
                            </tr>
                            <tr>
                                <td></td>
                                <td>
                                    <button type="button" id="zdec" class="btn btn-outline-secondary">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
                                             fill="currentColor" class="bi bi-arrow-down" viewBox="0 0 16 16">
                                            <path fill-rule="evenodd"
                                                  d="M8 1a.5.5 0 0 1 .5.5v11.793l3.146-3.147a.5.5 0 0 1 .708.708l-4 4a.5.5 0 0 1-.708 0l-4-4a.5.5 0 0 1 .708-.708L7.5 13.293V1.5A.5.5 0 0 1 8 1z"/>
                                        </svg>
                                    </button>
                                </td>
                                <td></td>
                            </tr>
                        </table>
                    </div>
                </div>

                <br><br>

                <h4 class="text-center">Positionswert</h4>
                <div align="center">
                    <div class="col-md-3 mb-1">
                        <input id="pos_value" type="text" class="form-control" placeholder="position">
                    </div>
                </div>


            </div>

            <div class="col">
                <div class="row">
                    <!-- XY jogging control panel -->
                    <div id="view-jog" class="col">
                        <br>
                        <h3 class="text-center">Aktuelle Messdaten</h3>
                        <br>

                        <div align="center">

                            <table>

                                <tr>
                                    <td>
                                        <h5 class="text-start">X-Position:</h5>
                                    </td>
                                    <td></td>
                                    <td>
                                        <h5><span id="bdg_x_pos" class="badge badge-danger">x-position</span></h5>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <h5 class="text-start">Y-Position:</h5>
                                    </td>
                                    <td></td>
                                    <td>
                                        <h5><span id="bdg_y_pos" class="badge badge-danger">y-position</span></h5>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <h5 class="text-start">Z-Position:</h5>
                                    </td>
                                    <td></td>
                                    <td>
                                        <h5><span id="bdg_z_pos" class="badge badge-danger">z-position</span></h5>
                                    </td>
                                </tr>
                                <tr>
                                    <td>
                                        <h5 class="text-start">Opt-Power:</h5>
                                    </td>
                                    <td></td>
                                    <td>
                                        <h5><span id="bdg_opw" class="badge badge-danger">opt-power</span></h5>
                                    </td>
                                </tr>

                            </table>

                        </div>

                    </div>

                </div>

                <style>

                    .btn-outline-secondary {
                        min-width: 40px;
                        max-width: 40px;
                    }

                    .center {
                        margin-left: auto;
                        margin-right: auto;
                    }

                </style>

                <!-- ############################################################################################################

                                  Script-Bereich - Programm-Quellen und  Java-Script-Funktionen

                  ############################################################################################################-->

                <!--Plugin CSS file with desired skin-->
                <link rel="stylesheet"
                      href="https://cdnjs.cloudflare.com/ajax/libs/ion-rangeslider/2.3.1/css/ion.rangeSlider.min.css"/>
                <!--jQuery-->
                <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
                <!--Plugin JavaScript file-->
                <script src="https://cdnjs.cloudflare.com/ajax/libs/ion-rangeslider/2.3.1/js/ion.rangeSlider.min.js"></script>
                <!--canvasjs-->
                <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
                <!--chartjs-->
                <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4"></script>

                <script>

                    // ******************** AJAX-Program
                    // Security-Init
                    $(document).ready(function () {
                        // to avoid token-Error
                        $.ajaxSetup({
                            headers: {"X-CSRFToken": '{{csrf_token}}'}
                        });
                    });

                    /* JavaScript-Version
                    // ******************** Global Variables + Initializing
                    let URL = "{% url 'view_update_drive' %}";

                    // ******************** View-Transfer
                    var dir_value = 'xyhome';
                    document.getElementById("yinc").onclick = function () {btnUpdateDrive('yinc');};
                    document.getElementById("ydec").onclick = function () {btnUpdateDrive('ydec');};
                    document.getElementById("xinc").onclick = function () {btnUpdateDrive('xinc');};
                    document.getElementById("xdec").onclick = function () {btnUpdateDrive('xdec');};
                    document.getElementById("xyhome").onclick = function () {btnUpdateDrive('xyhome');};
                    document.getElementById("zinc").onclick = function () {btnUpdateDrive('zinc');};
                    document.getElementById("zdec").onclick = function () {btnUpdateDrive('zdec');};
                    document.getElementById("zhome").onclick = function () {btnUpdateDrive('zhome');};

                    function btnUpdateDrive(dir_value) {
                        pos_value = document.getElementById('pos_value').value;
                        console.log("pos_value:" + pos_value + " dir_value:" + dir_value);
                        var data = {'pos_value': pos_value, 'dir_value': dir_value};
                        $.post(URL, data, function (response) {
                            if (response === 'success') {
                                console.log("Success");
                            } else {
                                console.log("Error");
                            }
                        });
                    }
                    */

                </script>

                <script>
                    // ******************** AJAX-Communication
                    $('.btn').click(function(){
                        console.log("success");
                        $.ajax({
                            url: 'ajax/position/',
                            type: 'get',
                            data: {
                                dir_value: (this.id),
                                pos_value: $("#pos_value").val()
                            },
                            success: function(response) {

                                if (response.dir_return == "xinc" || response.dir_return == "xdec") {
                                    $("#bdg_x_pos").text(response.pos_return);
                                    $("#bdg_opw").text(response.opw_return)
                                }

                                if (response.dir_return == "yinc" || response.dir_return == "ydec") {
                                    $("#bdg_y_pos").text(response.pos_return);
                                    $("#bdg_opw").text(response.opw_return)
                                }

                                if (response.dir_return == "zinc" || response.dir_return == "zdec") {
                                    $("#bdg_z_pos").text(response.pos_return);
                                    $("#bdg_opw").text(response.opw_return)
                                }

                                if  (response.dir_return == "xyhome") {
                                    $("#bdg_x_pos").text(response.pos_return);
                                    $("#bdg_y_pos").text(response.pos2_return);
                                    $("#bdg_opw").text(response.opw2_return)
                                }

                                if  (response.dir_return == "zhome") {
                                    $("#bdg_z_pos").text(response.pos_return);
                                    $("#bdg_opw").text(response.opw_return)
                                }
                            }
                        })
                    });
                </script>

{% endblock %}